---
- name: Install tools required in builders
  hosts: builders
  become: true
  gather_facts: true

  vars:
    # renovate: datasource=golang-version depName=golang
    go_version: "1.24.4"
    go_checksum: "77e5da33bb72aeaef1ba4418b6fe511bc4d041873cbf82e5aa6318740df98717"

  roles:
    - geerlingguy.docker
    - geerlingguy.go

  tasks:
    - name: Get Ubuntu codename
      ansible.builtin.command: lsb_release -cs
      register: ubuntu_codename
      changed_when: false

    - name: Update apt cache
      ansible.builtin.apt:
        update_cache: true

    - name: Install cockpit and related packages from backports
      ansible.builtin.apt:
        name:
          - cockpit
          - cockpit-machines
          - cockpit-packagekit
        default_release: "{{ ubuntu_codename.stdout }}-backports"
        state: present

    - name: Install monitoring tools
      ansible.builtin.apt:
        name:
          - prometheus-node-exporter
          - prometheus-node-exporter-collectors
        state: present
